<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Real Time Products</title>
    <script src="/socket.io/socket.io.js"></script>
</head>
<body>
    <h1>Real Time Product List</h1>

    <!-- Formulário para adicionar produto -->
    <form id="productForm">
        <input type="text" id="title" placeholder="Title" required>
        <input type="text" id="description" placeholder="Description" required>
        <input type="number" id="price" placeholder="Price" required>
        <input type="text" id="thumbnail" placeholder="Thumbnail URL" required>
        <input type="text" id="code" placeholder="Product Code" required>
        <input type="number" id="stock" placeholder="Stock" required>
        <input type="text" id="category" placeholder="Category" required>
        <button type="submit">Add Product</button>
    </form>

    <!-- Lista de produtos -->
    <ul id="productList">
        {{#each products}}
            <li>
                <strong>Title:</strong> {{this.title}} <br>
                <strong>Description:</strong> {{this.description}} <br>
                <strong>Price:</strong> ${{this.price}} <br>
                <strong>Thumbnail:</strong> <img src="{{this.thumbnail}}" alt="{{this.title}}" style="width: 50px; height: 50px;"> <br>
                <strong>Code:</strong> {{this.code}} <br>
                <strong>Stock:</strong> {{this.stock}} <br>
                <strong>Category:</strong> {{this.category}} <br>
                <hr>
            </li>
        {{/each}}
    </ul>

    <script>
        const socket = io();

        // Função para adicionar produtos à lista na tela
        const addProductsToList = (products) => {
            const productList = document.getElementById('productList');
            productList.innerHTML = ''; // Limpa a lista antes de adicionar novos produtos
            products.forEach(product => {
                const li = document.createElement('li');
                li.innerHTML = `
                    <strong>Title:</strong> ${product.title} <br>
                    <strong>Description:</strong> ${product.description} <br>
                    <strong>Price:</strong> $${product.price} <br>
                    <strong>Thumbnail:</strong> <img src="${product.thumbnail}" alt="${product.title}" style="width: 50px; height: 50px;"> <br>
                    <strong>Code:</strong> ${product.code} <br>
                    <strong>Stock:</strong> ${product.stock} <br>
                    <strong>Category:</strong> ${product.category} <br>
                    <hr>
                `;
                productList.appendChild(li);
            });
        };

        // Ao carregar a página, adiciona a lista de produtos já existente
        const initialProducts = {{{json products}}}; // Passa a lista de produtos em formato JSON
        addProductsToList(initialProducts);

        // Enviar dados do produto pelo WebSocket quando o formulário for enviado
        document.getElementById('productForm').addEventListener('submit', function(event) {
            event.preventDefault();
            const productData = {
                title: document.getElementById('title').value,
                description: document.getElementById('description').value,
                price: document.getElementById('price').value,
                thumbnail: document.getElementById('thumbnail').value,
                code: document.getElementById('code').value,
                stock: document.getElementById('stock').value,
                category: document.getElementById('category').value
            };

            // Emite o evento 'addProduct' para o servidor com os dados do produto
            socket.emit('addProduct', productData);

            // Limpar os campos do formulário após envio
            document.getElementById('productForm').reset();
        });

        // Atualizar lista de produtos em tempo real ao receber 'updateProducts'
        socket.on('updateProducts', (products) => {
            addProductsToList(products); // Atualiza a lista com a nova lista de produtos
        });
    </script>
</body>
</html>
